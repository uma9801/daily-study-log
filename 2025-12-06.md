#SQL #sqlite3 #python 
# SQL
## sqlite3
Pythonの機能であり、SQLiteデータベース用のDB.API2.0インターフェイス。
使用イメージ
- 3人の登場人物
	- 私：Pythonコードを記述
	- sqlite3のモジュール関数：DB室の開け閉めや、環境の保存、**SQL言語で書かれた指示・命令書をDBMSに渡す**
	- データベースマネジメントシステム(DBMS)：DBのデータを実際に操作
- コーディングでは、以下の2種類の記述を使ってDB（SQL）を操作していく。
	- DB室へのアクセスなどの管理をsqlite3のモジュール関数で書き、
	- DBMSにやってもらいたいデータ操作をSQL言語で書く。
# データベース
リレーショナルデータベース(RDB)
データを関係性（リレーショナル）で管理する、表形式のデータベース。
列（カラム）、行（レコード）、要素（フィールド）、各表をテーブルと呼ぶ。
現在のデータベースはほぼRDB。
## スキーマ
フォルダのようなもの。
テーブルの目的別に格納するデータベースを分けられる。
## クエリとトランザクション
データベースを操作する命令内容を**クエリ**と言う。
クエリの集合を**トランザクション**と言う。
トランザクションは、全てのクエリが実行されないと完了・反映されない。
- データの整合性や関係性を保てる。
- 銀行システムで、A→Bに50万円の送金をする場合
	1. Aの口座で50万円減らす
	2. Bの口座で50万円増やす
- 1だけ、2だけ成功しもう片方が失敗となってはシステムが破綻する。
- トランザクションなら両方成功して初めて反映されるので、整合性を保てる。
	- 一部の処理が失敗した場合、全ての処理が取り消されるということ。
## コミットとロールバック
トランザクションに対し、コミットとロールバックの処理が行える。
トランザクションで行われた処理を確定させるのが**コミット**。
処理を取り消して元に戻すのが**ロールバック**。
ただし、ロールバックできるのは**コミットされていない箇所**なので注意。
## カーソル
[Symfoware Server SQLビギナーズガイド - FUJITSU -](https://software.fujitsu.com/jp/manual/manualfiles/M070075/J2X01638/01Z200/sqlbg04/sqlbg033.html)
（上記サイトがとても分かり易い。）
表の中の1行を特定するためのシステム。
特定している1行に対して処理を実行する。
`DECLARE CURSOR`カーソルの宣言。（DECLARE：宣言する。×DECLEAR）
`OPEN`カーソルをオープン状態にし、取得したデータの表の先頭行直前にカーソルが位置する。
`FETCH`カーソルを1行移動し、移動先のデータを取り出す。
- 最終行を実行した後は、最終行直後にカーソルが位置する。
`UPDATE`カーソル行の内容を変更する。（カーソル位置はそのまま）
`DELETE`カーソル行の内容を削除する。（カーソルは前の行と次の行の間に位置する）
`CLOSE`カーソルをクローズ状態にする。
### カーソルの具体的な動き
- DECLARE CURSOR
- OPEN
	- 以下3つのいずれかを、最終行まで繰り返す。
	- FETCH
	- UPDATE
	- DELETE
		- CLOSE

## データ型
数字型：TYNYINT, INTEGER, FLOAT, DOUBULE... バイト数・最小最大値、整数・浮動小数が違う
文字型：CHAR, VARCHAR, TEXT バイト数・固定長・可変長が違う
日付・時刻型：DATETIME, TIMESTAMP, DATE, TIME, YEAR 日付時刻・日付のみ・時刻のみなど
NULL型：データが入っていない（存在しない）。空文字や0とは違う。
## SQL命令
DDL(Data Definition Language: データ定義言語)
- CREATE：データベース・テーブル作成
- ALTER：テーブル変更
- DROP：データベース・テーブル削除
DML(Data Manipulation Language: データ操作言語)
- INSERT：レコードの追加
- DELETE：レコードの削除
- UPDATE：レコードの更新
- SELECT：レコードの取得
DCL(Data Control Language: データ制御言語)
- COMMIT：更新処理の確定
- ROLLBACK：更新処理の取り消し
- SAVEPOINT：セーブポイントの設定
上記は全て予約語
### 大文字小文字の判定（MySQL）
テーブル名やレコード名：大小の区別なし
データ：大小の区別あり
### リテラル
SQL文中に書かれる具体的なデータをリテラルと呼ぶ。
数値リテラル：半角数字。123,353574
文字リテラル：''か""で囲う。'abcd' "01234" 'あいうえお'
日付リテラル：''か""で囲う。'2025-12-06' "2000-01-01 10:00:25"